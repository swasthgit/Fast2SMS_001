{% extends "base.html" %}

{% block title %}Send SMS - Fast2SMS Bulk Sender{% endblock %}

{% block content %}
<div class="hero">
    <h1>üîê API Configuration</h1>
    <p class="subtitle">Enter your Fast2SMS API credentials to send messages</p>
</div>

<div class="card">
    <div class="card-header">
        <h2>‚öôÔ∏è Configure Sending Settings</h2>
    </div>
    <div class="card-body">
        <form method="POST" class="config-form">
            <div class="form-group">
                <label for="api_key">Fast2SMS API Key <span class="required">*</span></label>
                <input type="text"
                       id="api_key"
                       name="api_key"
                       class="form-control"
                       placeholder="Enter your Fast2SMS API key"
                       required>
                <small class="form-help">Get your API key from <a href="https://www.fast2sms.com/dashboard" target="_blank">Fast2SMS Dashboard</a></small>
            </div>

            <div class="form-group">
                <label for="schedule_time">Schedule Time (Optional)</label>
                <input type="text"
                       id="schedule_time"
                       name="schedule_time"
                       class="form-control"
                       placeholder="YYYY-MM-DD-HH-MM (e.g., 2024-12-25-14-30)">
                <small class="form-help">Leave blank to send immediately. Format: Year-Month-Day-Hour-Minute (24-hour format)</small>
            </div>

            <div class="info-box">
                <h3>üìä Sending Summary</h3>
                <ul>
                    <li>Total messages to send: <strong>{{ session.total_rows }}</strong></li>
                    <li>Unique mobile numbers: <strong>{{ session.unique_mobiles }}</strong></li>
                    <li>Rate limiting: 0.2 seconds between messages</li>
                </ul>
            </div>

            <div class="warning-box">
                <h3>‚ö†Ô∏è Important Warnings</h3>
                <ul>
                    <li>This action cannot be undone once started</li>
                    <li>Ensure you have sufficient balance in your Fast2SMS account</li>
                    <li>Invalid mobile numbers or template IDs will fail</li>
                    <li>Messages will be charged according to your Fast2SMS plan</li>
                </ul>
            </div>

            <div class="form-actions">
                <button type="submit" class="btn btn-primary" id="sendBtn">
                    üöÄ Start Sending SMS
                </button>
                <a href="{{ url_for('preview') }}" class="btn btn-secondary">Back to Preview</a>
            </div>
        </form>
    </div>
</div>

<div class="card">
    <div class="card-header">
        <h2>üí° Tips for Successful Sending</h2>
    </div>
    <div class="card-body">
        <ul class="info-list">
            <li>Ensure your Fast2SMS account has sufficient balance</li>
            <li>Verify that your sender ID (MSWAST) is approved</li>
            <li>Double-check that DLT templates are registered</li>
            <li>Test with a small batch first before sending to all numbers</li>
            <li>Keep this window open while messages are being sent</li>
        </ul>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Confirm before sending
    document.querySelector('.config-form').addEventListener('submit', function(e) {
        const confirmed = confirm(
            '‚ö†Ô∏è Are you sure you want to send SMS to ' + {{ session.total_rows }} + ' numbers?\n\n' +
            'This action cannot be undone and will use your Fast2SMS credits.'
        );

        if (!confirmed) {
            e.preventDefault();
            return false;
        }

        // Show loading state
        const btn = document.getElementById('sendBtn');
        btn.textContent = '‚è≥ Processing... Please wait';
        btn.disabled = true;
    });

    // Validate schedule time format if provided
    const scheduleInput = document.getElementById('schedule_time');
    scheduleInput.addEventListener('blur', function() {
        const value = this.value.trim();
        if (value && !value.match(/^\d{4}-\d{2}-\d{2}-\d{2}-\d{2}$/)) {
            alert('Invalid schedule time format. Use: YYYY-MM-DD-HH-MM\nExample: 2024-12-25-14-30');
            this.focus();
        }
    });
</script>
{% endblock %}
