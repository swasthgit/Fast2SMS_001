{% extends "base.html" %}

{% block title %}Upload Data - Fast2SMS Bulk Sender{% endblock %}

{% block content %}
<div class="hero">
    <h1>üìÇ Upload Your Data File</h1>
    <p class="subtitle">Upload a CSV or XLSX file with your SMS data</p>
</div>

<div class="card">
    <div class="card-header">
        <h2>üì§ File Upload</h2>
    </div>
    <div class="card-body">
        <form method="POST" enctype="multipart/form-data" class="upload-form">
            <div class="file-upload-wrapper">
                <input type="file" name="file" id="file" accept=".csv,.xlsx" required>
                <label for="file" class="file-upload-label">
                    <div class="upload-icon">üìÅ</div>
                    <div class="upload-text">
                        <span class="upload-title">Click to select file</span>
                        <span class="upload-subtitle">or drag and drop here</span>
                        <span class="upload-formats">Supported: CSV, XLSX (Max 16MB)</span>
                    </div>
                </label>
                <div class="file-name" id="fileName"></div>
            </div>
            <div class="form-actions">
                <button type="submit" class="btn btn-primary">Upload & Continue</button>
                <a href="{{ url_for('index') }}" class="btn btn-secondary">Cancel</a>
            </div>
        </form>
    </div>
</div>

<div class="card">
    <div class="card-header">
        <h2>üìã File Requirements</h2>
    </div>
    <div class="card-body">
        <div class="requirements-grid">
            <div class="requirement-item">
                <h3>Required Columns</h3>
                <ul>
                    <li><code>mobile</code> - 10-digit mobile number</li>
                    <li><code>template_id</code> - Template ID from the list</li>
                    <li><code>v1, v2, v3, ...</code> - Variables for template</li>
                </ul>
            </div>
            <div class="requirement-item">
                <h3>Data Format</h3>
                <ul>
                    <li>Mobile: 9876543210 (no +91)</li>
                    <li>Template ID: Choose from approved list</li>
                    <li>Variables: Fill only what's needed</li>
                </ul>
            </div>
            <div class="requirement-item">
                <h3>Example Row</h3>
                <div class="example-row">
                    <table>
                        <tr>
                            <th>mobile</th>
                            <th>v1</th>
                            <th>v2</th>
                            <th>v3</th>
                            <th>template_id</th>
                        </tr>
                        <tr>
                            <td>9876543210</td>
                            <td>John</td>
                            <td>12345</td>
                            <td>Health Plus</td>
                            <td>173865</td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="card">
    <div class="card-header">
        <h2>‚ùì Need a Sample File?</h2>
    </div>
    <div class="card-body text-center">
        <p>Download our pre-formatted sample file to get started quickly</p>
        <a href="{{ url_for('download_sample') }}" class="btn btn-success">Download Sample CSV</a>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Show selected file name
    const fileInput = document.getElementById('file');
    const fileNameDisplay = document.getElementById('fileName');

    fileInput.addEventListener('change', function(e) {
        if (e.target.files.length > 0) {
            const fileName = e.target.files[0].name;
            const fileSize = (e.target.files[0].size / 1024 / 1024).toFixed(2);
            fileNameDisplay.textContent = `Selected: ${fileName} (${fileSize} MB)`;
            fileNameDisplay.style.display = 'block';
        }
    });

    // Drag and drop styling
    const uploadWrapper = document.querySelector('.file-upload-wrapper');

    uploadWrapper.addEventListener('dragover', function(e) {
        e.preventDefault();
        uploadWrapper.classList.add('drag-over');
    });

    uploadWrapper.addEventListener('dragleave', function(e) {
        e.preventDefault();
        uploadWrapper.classList.remove('drag-over');
    });

    uploadWrapper.addEventListener('drop', function(e) {
        e.preventDefault();
        uploadWrapper.classList.remove('drag-over');
        fileInput.files = e.dataTransfer.files;

        if (fileInput.files.length > 0) {
            const fileName = fileInput.files[0].name;
            const fileSize = (fileInput.files[0].size / 1024 / 1024).toFixed(2);
            fileNameDisplay.textContent = `Selected: ${fileName} (${fileSize} MB)`;
            fileNameDisplay.style.display = 'block';
        }
    });
</script>
{% endblock %}
